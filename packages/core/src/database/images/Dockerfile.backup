FROM alpine:3
RUN echo 'https://dl-cdn.alpinelinux.org/alpine/edge/community' >> /etc/apk/repositories
RUN apk update && apk upgrade --no-cache
RUN apk add pgbackrest --no-cache

RUN addgroup pgbackrest
RUN cat /etc/group
RUN adduser -D -h /var/lib/pgbackrest -s /bin/sh -G pgbackrest pgbackrest
RUN chown pgbackrest:pgbackrest /var/log/pgbackrest
RUN mkdir -p /main/backup
RUN chown pgbackrest:pgbackrest /main/backup

USER pgbackrest

CMD ["pgbackrest", "server", "--config=/etc/pgbackrest/pgbackrest.conf"]
